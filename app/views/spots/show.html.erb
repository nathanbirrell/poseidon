<!-- TODO: Figure out a nice way to handle notices -->
<p id="notice"><%= notice %></p>

<% if (!@spot.current_swell || !@spot.current_wind) %>
  <h2><%= @spot.name %></h2>
  <p>No forecast data available for this spot.</p>
  <p>Please run a <code>rails forecasts:update</code> then refresh.</p>
<% else %>

  <% content_for :before_main do %>
    <div class="row spot-banner">
      <div class="spot-banner__image-wrapper">
        <img alt="slide image" src="<%= @spot.image %>">
      </div>
      <div class="row spot-banner__content">
        <div class="small-12 columns text-center">
          <h2>
            <%= @spot.name %>, <br>
            <small><%= link_to @region.name, @region %>, <%= @region.state %></small>
          </h2>
          <p class="spot-banner__updated-date">Updated <%= @spot.current_swell.updated_at.localtime.strftime("%a, %e %b %Y %H:%M") %></p>
        </div>
      </div>
    </div>
  <% end %>

  <% if user_signed_in? %>
    <div class="text-center">
      Admin actions: <br>
      <%= link_to 'Edit Spot', edit_spot_path(@spot), class: 'button' %> <br>
    </div>
  <% end %>

  <div class="row">
    <div class="large-12 columns">
      <div class="row">
        <div class="small-12 large-3 columns text-center large-text-left panel">
          <h4>Overall potential</h4>
          <span class="<%= 'success' if @spot.current_potential > 75.0 %>">
            <%= @spot.current_potential %>%
          </span>
        </div>
        <div class="small-12 medium-4 large-3 columns panel">
          <h4>Swell</h4>
          <p><%= @spot.current_swell.rating %>%</p>
          <p>
            <ul>
              <li><strong>Size:</strong> <%= @spot.current_swell.size.round(2) %>m</li>
              <li><strong>Period:</strong> <%= @spot.current_swell.period.round(2)  %>s</li>
              <li><strong>Direction:</strong> <%= @spot.current_swell.direction %> degrees OR <%= @spot.current_swell.direction.degrees.round(2)  %> radians <br></li>
              <li> at <%= @spot.current_swell.date_time.localtime.strftime("%a, %e %b %Y %H:%M") %></li>
            </ul>
          </p>
        </div>
        <div class="small-12 medium-4 large-3 columns panel">
          <h4>Wind</h4>
          <p><%= @spot.current_wind.rating %>%</p>
          <p>
            <ul>
              <li><strong>Speed:</strong> <%= @spot.current_wind.speed %> km/h from</li>
              <li><strong>Direction:</strong> <%= @spot.current_wind.direction %> degrees OR <%= @spot.current_wind.direction.degrees.round(2)  if @spot.current_wind.direction %> radians <br></li>
              <li> at <%= @spot.current_wind.date_time.localtime.strftime("%a, %e %b %Y %H:%M") %></li>
            </ul>
          </p>
        </div>
        <div class="small-12 medium-4 large-3 columns panel">
          <h4>Tide</h4>
          <p><%= @spot.current_tide_rating %>%</p>
          <p>
            <ul>
              <li><strong>Height:</strong> <%= @spot.current_tide_height %>m above sea level</li>
              <li><strong>Phase:</strong> <%= tide_incoming_or_outgoing(@spot.last_tide.tide_type) %></li>
              <li><strong>Next tide (<%= @spot.next_tide.tide_type %>):</strong> <%= @spot.next_tide.height %>m above sea level in TODO hrs:mins (at
              <%= @spot.next_tide.date_time.localtime.strftime("%H:%M") %>)</li>
              <% if (@spot.tide_time_remaining != 0) %>
                <li><strong>Time remaining:</strong> <%= @spot.tide_time_remaining %> hours</li>
              <% end %>
            </ul>
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="large-12 columns">
      <div class="small-12 columns">
        <h4>About</h4>
        <hr>
      </div>
      <div class="large-6 columns">
        <h5 class="subheader"><%= @spot.description %></h5>
      </div>
      <div class="large-6 columns">
        <p>
          <strong>Optimal wind direction:</strong>
          <%= @spot.wind_optimal_direction %> degrees with <%= @spot.wind_optimal_direction_max_variance %> variance
          <br>
          <strong>Optimal wind strength:</strong>
          <%= @spot.wind_optimal_strength_min_kmh %> - <%= @spot.wind_optimal_strength_max_kmh %> kmh
          <br>
          <strong>Optimal swell direction:</strong>
          <%= @spot.swell_optimal_direction %> degrees with <%= @spot.swell_optimal_direction_max_variance %> variance
          <br>
          <strong>Optimal swell size:</strong>
          <%= @spot.swell_optimal_size_min_metres %> - <%= @spot.swell_optimal_size_max_metres %> metres
          <br>
          <strong>Optimal swell period:</strong>
          <%= @spot.swell_optimal_period_seconds %> secs
          <br>
          <strong>Optimal tides:</strong>
          <%= "#{@spot.tide_optimal_min_metres}m to #{@spot.tide_optimal_max_metres}m" %>
          <br>
          <strong>Season:</strong> <%= @spot.season %> <br>
          <strong>Lat/long: </strong> <%= @spot.latitude %>, <%= @spot.longitude %>

        </p>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="large-12 columns">
      <iframe
      width="100%"
      height="250"
      frameborder="0" style="border:0"
      src="https://www.google.com/maps/embed/v1/place?key=AIzaSyDVFmco07GE43aqioYPI5Ccfl_DJlGkBJo
        &q=loc:<%= @spot.latitude %>+<%= @spot.longitude %>&zoom=15" allowfullscreen>
      </iframe>
    </div>
  </div>


  <div class="row">
    <div class="small-12 medium-4 columns">
      <h3><%= "Swell Models for #{@spot.name}" %></h3>
      <%= swell_models_table(@forecasts_swells) %>
    </div>
    <div class="small-12 medium-4 columns">
      <h3><%= "Wind Models for #{@spot.name}" %></h3>
      <%= wind_models_table(@forecasts_winds) %>
    </div>
    <div class="small-12 medium-4 columns">
      <h3><%= "Tide Models for #{@spot.name}" %></h3>
      <%= tide_models_table(@forecasts_tides) %>
    </div>
  </div>

<% end %>
